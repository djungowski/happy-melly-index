<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport" />
    <link rel="stylesheet" type="text/css" href="css/melly.css" media="all" />
    <script type="text/javascript" src="js/jquery-2.0.2.min.js"></script>
    <script type="text/javascript" src="js/happy-melly-index.js"></script>
</head>
<body>
	<h1>Happy Melly Index</h1>

	<form action="">
		<p>
			<label>Where do you live in?</label>
			<select name="origin"></select>
		</p>

		<p>
			<label>What is your price? (in <span id="currency"></span>)</label>
			<input type="text" name="origin-price" id="origin-price" value="1000" />
		</p>

		<p>
			<label>What is your destination country?</label>
			<select name="destination"></select>
		</p>

		<p>
			<span>Happy Melly Index suggests a price of</span>
			<span id="final-price"></span>
			<span id="final-currency"></span>
		</p>
	</form>
	<script type="text/javascript">
	var updateFinalPrice = function() {
		var price,
			currency,
			origin,
			originIndex,
			originPrice,
			destination,
			destinationIndex,
			destinationPrice;

		originIndex = $('select[name="origin"] option:selected').val();
		destinationIndex = $('select[name="destination"] option:selected').val();
		origin = window.happyMellyIndex[originIndex];
		destination = window.happyMellyIndex[destinationIndex];

		originPrice = $('#origin-price').val();

		destinationPrice = Math.round(originPrice / origin['ratio'] * destination['ratio']);

		$('#final-currency').html(destination['currency']);
		$('#final-price').html(destinationPrice);
	};
	</script>

	<script type="text/javascript">
	$('select[name="origin"]').on('change', function(event) {
		var index,
			country;

		index = $(event.target).find('option:selected').val();
		country = window.happyMellyIndex[index];
		$('#currency').html(country['currency']);
		updateFinalPrice();
	});
	$('select[name="destination"]').on('change', updateFinalPrice);
	$('#origin-price').on('keyup', updateFinalPrice);
	</script>

	<script type="text/javascript">
		var selects,
			option,
			country;

		selects = $('select');
		for (var index in window.happyMellyIndex) {
			country = window.happyMellyIndex[index];
			if (index == 0) {
				$('#currency').html(country['currency']);
			}
			option = $('<option value="' + index + '">' + country['name'] + '</option>');
			selects.append(option);
		}
		updateFinalPrice();
	</script>
</body>
</html>